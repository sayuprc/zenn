---
title: "DDLã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["mysql", "postgresql", "sqlserver", "oracle", "sqlite"]
published: true
---

Oracle Database ã®çµŒé¨“ãŒã‚ã‚‹å…ˆè¼©ã¯ã€DDL ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ããªã„ã¨è¨€ã£ã¦ã„ãŸã€‚
ä¸€æ–¹ã§ SQL Server ã®çµŒé¨“ãŒã‚ã‚‹å…ˆè¼©ã¯ã§ãã‚‹ã¨è¨€ã£ã¦ã„ãŸã€‚
DBMS ã«ã‚ˆã£ã¦æŒ™å‹•ãŒé•ã†ã‚ˆã†ãªã®ã§ã€æ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚

## ç’°å¢ƒ

Docker ä¸Šã«ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

|åç§°|ãƒãƒ¼ã‚¸ãƒ§ãƒ³|
|---|---|
|MySQL|8.0.31|
|PostgreSQL|14.5|
|SQL Server|2019 15.0.4261.1|
|Oracle Database|21c Express Edition Release 21.0.0.0.0|
|SQLite|3.39.4|

```yml:docker-compose.yml
version: '3.9'

services:
  mysql:
    image: mysql:8.0.31
    environment:
      MYSQL_ROOT_PASSWORD: 'root'
    ports:
      - 3306:3306

  postgresql:
    image: postgres:14.5
    environment:
      POSTGRES_USER: 'postgres'
      POSTGRES_PASSWORD: 'postgres'
    ports:
      - 5432:5432

  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
      ACCEPT_EULA: 'Y'
      SA_PASSWORD: 'rootRootr00t'
    ports:
      - 1433:1433

  oracle:
    image: oracle/database:21.3.0-xe
    environment:
      - ORACLE_PWD=passw0rd
    ports:
      - 1521:1521

  sqlite:
    image: keinos/sqlite3:latest
    tty: true
```

## æ¤œè¨¼æ–¹æ³•

ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¤ºçš„ã«é–‹å§‹ã—ã€CREATE/ALTER/DROP ã‚’å®Ÿè¡Œå¾Œã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¾ã™ã€‚(ä¸‹è¨˜ã¯ MySQL ç”¨ã®ã‚¯ã‚¨ãƒªã§ã™ã€‚)

alter_test ã¨ drop_test ã¯ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ã‚ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

```sql
-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
BEGIN;

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ(CREATE)
CREATE TABLE create_test(
  id INT
);

-- ã‚«ãƒ©ãƒ è¿½åŠ (ALTER)
ALTER TABLE alter_test ADD COLUMN name VARCHAR(10);

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤(DROP)
DROP TABLE drop_test;

-- å–ã‚Šæ¶ˆã—
ROLLBACK;
```

## çµæœ

|åç§°|ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯|
|---|---|
|MySQL|ã§ããªã„|
|PostgreSQL|ã§ãã‚‹|
|SQL Server|ã§ãã‚‹|
|Oracle Database|ã§ããªã„|
|SQLite|ã§ãã‚‹|

:::details ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œçµæœ(é•·ã„ã®ã§æ³¨æ„)

### MySQL

```sql
-- æ¤œè¨¼å‰
mysql> SHOW TABLES;
+------------------+
| Tables_in_sample |
+------------------+
| alter_test       |
| drop_test        |
+------------------+
2 rows in set (0.00 sec)

-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
mysql> BEGIN;
Query OK, 0 rows affected (0.00 sec)

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
mysql> CREATE TABLE create_test(
    -> id INT
    -> );
Query OK, 0 rows affected (0.03 sec)

-- ä½œæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
mysql> SHOW TABLES;
+------------------+
| Tables_in_sample |
+------------------+
| alter_test       |
| create_test      |
| drop_test        |
+------------------+
3 rows in set (0.00 sec)

-- ã‚«ãƒ©ãƒ è¿½åŠ 
mysql> ALTER TABLE alter_test ADD COLUMN name VARCHAR(10);
Query OK, 0 rows affected (0.03 sec)
Records: 0  Duplicates: 0  Warnings: 0

-- ã‚«ãƒ©ãƒ è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
mysql> DESC alter_test;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int         | YES  |     | NULL    |       |
| name  | varchar(10) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
mysql> DROP TABLE drop_test;
Query OK, 0 rows affected (0.02 sec)

-- å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
mysql> SHOW TABLES;
+------------------+
| Tables_in_sample |
+------------------+
| alter_test       |
| create_test      |
+------------------+
2 rows in set (0.00 sec)

-- å–ã‚Šæ¶ˆã—
mysql> ROLLBACK;
Query OK, 0 rows affected (0.00 sec)

-- ROLLBACKå¾Œã‚‚å¤‰æ›´ã¯åæ˜ ã•ã‚Œã¦ã„ã‚‹
mysql> SHOW TABLES;
+------------------+
| Tables_in_sample |
+------------------+
| alter_test       |
| create_test      |
+------------------+
2 rows in set (0.00 sec)

mysql> DESC alter_test;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int         | YES  |     | NULL    |       |
| name  | varchar(10) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec)
```

### PostgreSQL

```sql
-- æ¤œè¨¼å‰
sample=# \dt
           List of relations
 Schema |    Name    | Type  |  Owner
--------+------------+-------+----------
 public | alter_test | table | postgres
 public | drop_test  | table | postgres
(2 rows)

-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
sample=# BEGIN;
BEGIN

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
sample=*# CREATE TABLE create_test(
id INT
);
CREATE TABLE

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sample=*# \dt
            List of relations
 Schema |    Name     | Type  |  Owner
--------+-------------+-------+----------
 public | alter_test  | table | postgres
 public | create_test | table | postgres
 public | drop_test   | table | postgres
(3 rows)

-- ã‚«ãƒ©ãƒ è¿½åŠ 
sample=*# ALTER TABLE alter_test ADD COLUMN name VARCHAR(10);
ALTER TABLE

-- ã‚«ãƒ©ãƒ è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sample=*# \d alter_test;
                    Table "public.alter_test"
 Column |         Type          | Collation | Nullable | Default
--------+-----------------------+-----------+----------+---------
 id     | integer               |           |          |
 name   | character varying(10) |           |          |

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
sample=*# DROP TABLE drop_test;
DROP TABLE

-- å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sample=*# \dt
            List of relations
 Schema |    Name     | Type  |  Owner
--------+-------------+-------+----------
 public | alter_test  | table | postgres
 public | create_test | table | postgres
(2 rows)

-- å–ã‚Šæ¶ˆã—
sample=*# ROLLBACK;
ROLLBACK

-- ROLLBACK ã—ãŸã®ã§æ¤œè¨¼å‰ã¨åŒã˜çŠ¶æ…‹
sample=# \dt
           List of relations
 Schema |    Name    | Type  |  Owner
--------+------------+-------+----------
 public | alter_test | table | postgres
 public | drop_test  | table | postgres
(2 rows)

sample=# \d alter_test;
             Table "public.alter_test"
 Column |  Type   | Collation | Nullable | Default
--------+---------+-----------+----------+---------
 id     | integer |           |          |
```

### SQL Server

```sql
-- æ¤œè¨¼å‰
1> SELECT name FROM sysobjects WHERE xtype = 'U'
2> GO
name
--------------------------------------------------------------------------------
alter_test
drop_test

(2 rows affected)

-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
1> BEGIN TRANSACTION;

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
3> CREATE TABLE create_test(
4>   id INT
5> );
6> GO

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
1> SELECT name FROM sysobjects WHERE xtype = 'U'
2> GO
name
--------------------------------------------------------------------------------
alter_test
drop_test
create_test

(3 rows affected)

-- ã‚«ãƒ©ãƒ è¿½åŠ 
1> ALTER TABLE alter_test ADD name VARCHAR(10);
2> GO

-- ã‚«ãƒ©ãƒ è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
1> SELECT * FROM alter_test;
2> GO
id          name
----------- ----------

(0 rows affected)

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
1> DROP TABLE drop_test;
2> GO

-- å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
1> SELECT name FROM sysobjects WHERE xtype = 'U'
2> GO
name
--------------------------------------------------------------------------------
alter_test
create_test

(2 rows affected)

-- å–ã‚Šæ¶ˆã—
1> ROLLBACK;
2> GO

-- ROLLBACK ã—ãŸã®ã§æ¤œè¨¼å‰ã¨åŒã˜çŠ¶æ…‹
1> SELECT name FROM sysobjects WHERE xtype = 'U'
2> GO
name
--------------------------------------------------------------------------------
alter_test
drop_test

(2 rows affected)

1> SELECT * FROM alter_test;
2> GO
id
-----------

(0 rows affected)
```

### Oracle Database

```sql
-- æ¤œè¨¼å‰
SQL> SELECT TABLE_NAME FROM USER_TABLES WHERE TABLE_NAME IN ('CREATE_TEST', 'ALTER_TEST', 'DROP_TEST');

TABLE_NAME
--------------------------------------------------------------------------------
ALTER_TEST
DROP_TEST

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
SQL> CREATE TABLE create_test(
  2    id INT
  3  );

Table created.

-- å–ã‚Šæ¶ˆã—
SQL> ROLLBACK;

Rollback complete.

-- ä½œæˆã•ã‚Œã¦ã„ã‚‹
SQL> SELECT TABLE_NAME FROM USER_TABLES WHERE TABLE_NAME IN ('CREATE_TEST', 'ALTER_TEST', 'DROP_TEST');

TABLE_NAME
--------------------------------------------------------------------------------
ALTER_TEST
CREATE_TEST
DROP_TEST

-- ã‚«ãƒ©ãƒ è¿½åŠ 
SQL> ALTER TABLE alter_test ADD (name VARCHAR(10));

Table altered.

-- å–ã‚Šæ¶ˆã—
SQL> ROLLBACK;

Rollback complete.

-- ã‚«ãƒ©ãƒ è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
SQL> SELECT COLUMN_NAME FROM ALL_TAB_COLUMNS WHERE TABLE_NAME = 'ALTER_TEST';

COLUMN_NAME
--------------------------------------------------------------------------------
NAME
ID

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
SQL> DROP TABLE drop_test;

Table dropped.

-- å–ã‚Šæ¶ˆã—
SQL> ROLLBACK;

Rollback complete.

-- å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
SQL> SELECT TABLE_NAME FROM USER_TABLES WHERE TABLE_NAME IN ('CREATE_TEST', 'ALTER_TEST', 'DROP_TEST');

TABLE_NAME
--------------------------------------------------------------------------------
ALTER_TEST
CREATE_TEST
```

### SQLite

```sql
-- æ¤œè¨¼å‰
sqlite> .tables
alter_test  drop_test

-- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
sqlite> BEGIN TRANSACTION;

-- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
sqlite> CREATE TABLE create_test(
   ...>   id INT
   ...> );

-- ä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sqlite> .tables
alter_test   create_test  drop_test

-- ã‚«ãƒ©ãƒ è¿½åŠ 
sqlite> ALTER TABLE alter_test ADD COLUMN name VARCHAR(10);

-- ã‚«ãƒ©ãƒ è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sqlite> .schema alter_test
CREATE TABLE alter_test (
  id INT
, name VARCHAR(10));

-- ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
sqlite> DROP TABLE drop_test;

-- å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
sqlite> .tables
alter_test   create_test

-- å–ã‚Šæ¶ˆã—
sqlite> ROLLBACK TRANSACTION;

-- ROLLBACK ã—ãŸã®ã§æ¤œè¨¼å‰ã¨åŒã˜çŠ¶æ…‹
sqlite> .tables
alter_test  drop_test

sqlite> .schema alter_test
CREATE TABLE alter_test (
  id INT
);
```

:::

## ã¾ã¨ã‚

MySQL ã¨ Oracle Database ã§ã¯ã€DDL ã®å‰ã«æš—é»™ã®ã‚³ãƒŸãƒƒãƒˆãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚
ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œãªã„ã®ã§ã€ä¸Šè¨˜ã® RDBMS ã‚’ä½¿ã†ã¨ãã¯ã‚ˆã‚Šä¸€å±¤æ°—ã‚’ä»˜ã‘ãªã„ã¨ã„ã‘ãªã„ã§ã™ã­ã€‚

## å‚è€ƒ

[ã€Dockerã€‘Oracleã‚’ç„¡æ–™ã§ç°¡å˜ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/re24_1986/articles/29430f2f8b4b46)
[MySQL :: MySQL 8.0 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 13.3.3 æš—é»™çš„ãªã‚³ãƒŸãƒƒãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ](https://dev.mysql.com/doc/refman/8.0/ja/implicit-commit.html)
[3.4. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³](https://www.postgresql.jp/document/14/html/tutorial-transactions.html)
[SQL Server ã® Transactions ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ - SQL Server | Microsoft Learn](https://learn.microsoft.com/ja-jp/sql/relational-databases/performance-monitor/sql-server-transactions-object?view=sql-server-ver16)
[SQLæ–‡: ALTER CLUSTERï½ALTER JAVA](https://docs.oracle.com/cd/F25597_01/document/products/oracle11g/111/doc_dvd/server.111/E05750-03/statements_1.htm#7265)
[Transaction](https://www.sqlite.org/lang_transaction.html)